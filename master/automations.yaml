#------------ Startup notification ------------------------
- alias: Startup
  hide_entity: True
  trigger:
      platform: homeassistant
      event: start
  action:
      - service: tts.picotts_say
        entity_id: media_player.hall_speaker
        data:
            message: Home automation started
      - service: shell_command.snapshot_clear_locks #clear all snapshot locks on startup
      - service: script.turn_on  #trigger RPi slaves to send their known statusses again
        data:
            entity_id: script.trigger_slave_poll
      - service: script.turn_on
        data:
            entity_id: script.reset_lights
#------------ Snapshots ------------------------
- id: snapshots_frontdoor
  alias: Frontdoor snapshots
  hide_entity: False
  trigger:
    platform: time
    seconds: '/9' #every ten seconds
  action:
    - service: shell_command.snapshot_frontdoor
- id: snapshots_hallupstairs
  alias: Hall upstairs snapshots
  hide_entity: False
  trigger:
    platform: time
    seconds: '/11' #every eleven seconds
  action:
    - service: shell_command.snapshot_hallupstairs
- id: snapshots_livingroom
  alias: Living room camera snapshots
  hide_entity: False
  trigger:
    platform: time
    seconds: '/3' #every five seconds
  action:
    - service: shell_command.snapshot_livingroom
- id: snapshots_street
  alias: Street camera snapshots
  hide_entity: False
  trigger:
    platform: time
    seconds: '/3' #every three seconds
  action:
    - service: shell_command.snapshot_street
- id: snapshots_garden
  alias: Garden camera snapshots
  hide_entity: False
  trigger:
    platform: time
    seconds: '/5' #every five seconds
  action:
    - service: shell_command.snapshot_garden
- alias: Archive snapshots
  hide_entity: False
  trigger:
    platform: time
    at: "00:00:00"
  action:
    - service: shell_command.archive_snapshots
- id: door_notification
  alias: Door notification
  trigger:
      - platform: state
        entity_id: binary_sensor.frontdoor
        to: "on"
      - platform: state
        entity_id: binary_sensor.backdoor
        to: "on"
  condition:
      - condition: time
        after: '23:00:00'
        before: '05:00:00'
      - condition: state
        entity_id: binary_sensor.anybodyhome
        state: "on"
  action:
      - service: tts.picotts_say
        entity_id: media_player.hall_speaker
        data:
            message: Door open
- id: lights_on_evening
  alias: Lights on in the evening
  trigger:
      platform: sun
      event: sunset
      offset: '-00:45:00'
  action:
      service: switch.turn_on
      entity_id: group.living_lights
- id: garden_lights_on_evening
  alias: Garden lights on in the evening
  trigger:
      platform: sun
      event: sunset
      offset: '01:00:00'
  action:
      service: switch.turn_on
      entity_id: group.garden_lights
- id: lights_off_night
  alias: Lights off at night
  trigger:
      platform: time
      at: '01:00:00'
  action:
      service: switch.turn_off
      entity_id: group.all_lights
- id: doorbell
  alias: Doorbell
  trigger:
      platform: state
      entity_id: binary_sensor.doorbell
      from: "off"
      to: "on"
  action:
      service: script.turn_on
      entity_id: script.doorbell_sound
- id: ipcam_topreset
  alias: Camera to preset
  trigger:
      platform: state
      entity_id: input_select.ipcam_direction
  action:
      service: script.turn_on
      entity_id: script.ipcam_topreset
- id: alarm_trigger
  alias: 'Trigger alarm while armed away'
  trigger:
    - platform: state
      entity_id: binary_sensor.frontdoor
      to: 'on'
    - platform: state
      entity_id: binary_sensor.backdoor
      to: 'on'
    - platform: state
      entity_id: binary_sensor.bedroomwindow_left
      to: 'on'
    - platform: state
      entity_id: binary_sensor.bedroomwindow_right
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.ha_alarm
      state: armed_away
  action:
    - service: alarm_control_panel.alarm_trigger
      entity_id: alarm_control_panel.ha_alarm
    - service: script.turn_on
      entity_id: script.alarm
    - service: switch.turn_on
      entity_id: group.all_lights
- id: arm
  alias: 'Arm system when away'
  trigger:
    - platform: state
      entity_id: binary_sensor.anybodyhome
      to: 'off'
  action:
    - service: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.ha_alarm
    - service: tts.picotts_say
      entity_id: media_player.hall_speaker
      data:
          message: System armed
- id: disarm
  alias: 'Disarm system when home'
  trigger:
    - platform: state
      entity_id: binary_sensor.anybodyhome
      to: 'on'
  action:
    - service: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.ha_alarm










#TODO: turn lights on and off in the morning
#TODO: alarm
#TODO: presence greeting
#TODO: door still open notifications
#TODO: wake up clock
