homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 161
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Amsterdam

  customize: !include customize.yaml


# Enables the frontend
frontend:
    javascript_version: latest
    extra_html_url:
        - /local/custom_ui/state-card-tiles.html
    extra_html_url_es5:
        - /local/custom_ui/state-card-tiles.html
    themes: !include themes.yaml

# Enables configuration UI
config:

http:
  api_password: !secret api_password
  use_x_forwarded_for: True
  base_url: !secret base_url
  ip_ban_enabled: True
  login_attempts_threshold: 5

weblink:
    entities:
        - name: Kodi Control Interface
          url: !secret kodi_pi1_url
          icon: mdi:kodi
        - name: MPD Control Interface
          url: !secret mpd_url
          icon: mdi:music-box-outline
        - name: MPD Music Stream
          url: !secret music_stream_url
          icon: mdi:play-circle
        - name: Wifi Router
          url: !secret wifi_router_url
          icon: mdi:router-wireless
        - name: IPCam
          url: !secret ipcam_url
          icon: mdi:camcorder
        - name: KPN Router
          url: !secret kpn_router_url
          icon: mdi:upload-network


# Checks for available updates
# Note: This component will send some information about your system to
# the developers to assist with development of Home Assistant.
# For more information, please see:
# https://home-assistant.io/blog/2016/10/25/explaining-the-updater/
updater:
  # Optional, allows Home Assistant developers to focus on popular components.
  # include_used_components: true

# Discover some devices automatically
discovery:

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

recorder:
    db_url: !secret db_url
    exclude:
      domains:
        - shell_command
        - weblink
        - group
      entities: !include exclude.yaml

# Enables support for tracking state changes over time.
history:
    exclude:
      domains:
        - shell_command
        - weblink
        - group
      entities: !include exclude.yaml

influxdb:
    host: 127.0.0.1
    username: home-assistant
    password: !secret api_password
    exclude:
      domains:
        - shell_command
        - weblink
        - group
      entities: !include exclude.yaml

# View all events in a logbook
logbook:
    include:
      domains:
        - device_tracker
        - media_player
        - alarm_control_panel
        - automation
      entities:
        - binary_sensor.front_door
        - binary_sensor.back_door
        - binary_sensor.bedroom_window_left
        - binary_sensor.bedroom_window_right
        - binary_sensor.bathroom_window_sensor
        - binary_sensor.doorbell
        - binary_sensor.anybodyhome
        - binary_sensor.noise
        - script.watch_tv
        - script.media_centre
        - script.listen_to_music
        - script.play_youtube_playlist
        - script.desktop
        - script.turn_media_off
        - script.lights_on
        - script.lights_off
        - script.alarm
        - script.ignite_dresser_ambilight
        - script.ignite_fireplace
        - script.extinguish_dresser_ambilight
        - script.extinguish_fireplace
        - script.wake_up_alarm
    exclude:
      entities:
        - automation.frontdoor_snapshots
        - automation.garden_snapshots
        - automation.street_snapshots
        - automation.living_room_snapshots
        - automation.hall_upstairs_snapshots

# Track the sun
sun:

zwave:
    usb_path: /dev/ttyACM0
    #debug: true


shell_command:
    snapshot_livingroom: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh livingroom "{{ states.input_boolean.flip_main_camera.state }}"
    snapshot_street: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh street
    snapshot_garden: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh garden
    snapshot_frontdoor: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh frontdoor
    snapshot_hallupstairs: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh hallupstairs
    archive_snapshots: /home/homeautomation/homeassistant/scripts/camera/archive.sh
    event_snapshots: /home/homeautomation/homeassistant/scripts/camera/eventsnapshots.sh "{{ cams }}"
    snapshot_clear_locks: find "/home/homeautomation/homeassistant/snapshots/" -type f -name "*.lock" | xargs rm
    oldstreetcam_reset_1: !secret oldstreetcam_noir_command
    oldstreetcam_reset_2: !secret oldstreetcam_quality_command
    hallspeaker_normalvolume: "amixer set Master 60%"
    hallspeaker_fullvolume: "amixer set Master 100%"

rest_command:
    ipcam_topreset:
        url: 'http://{{ ip }}/cgi/ptdc.cgi?command=goto_preset_position&index={{ index }}'
        username: !secret ipcam_user
        password: !secret ipcam_password

alarm_control_panel:
    - platform: manual
      name: Alarm System
      trigger_time: 5

device_tracker:
    - platform: tplink
      host: !secret wifirouter_host
      username: !secret wifirouter_user
      password: !secret wifirouter_pass
    - platform: ping
      hosts:
          pi1: !secret pi1_ip
          pi2: !secret pi2_ip
          pi3: !secret pi3_ip
          mhysa: !secret mhysa_ip
          wifi_router: !secret wifi_router_ip
          kpn_router: !secret kpn_router_ip

# Text to speech
tts:
  platform: google
  language: 'en-GB'

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
camera: !include cameras.yaml


input_select:
    ipcam_direction:
        name: Camera Direction Living room
        options:
            - Hall
            - Dresser
            - Back
            - TV
            - Couch
            - Front
            - Bed Jaiko
            - Floor
            - Mand Jaiko
    fireplace:
        name: Fireplace
        options:
            - Fire
            - Lamp
            - Ambilight
            - Rainbow Cycle
            - Colorcycle Fast
            - Colorcycle
            - Colorcycle Slow
            - Sirene
            - Red Cycle
            - Green Cycle
            - Blue Cycle
            - Red
            - Green
            - Blue
            - Yellow
            - Purple
            - Cyan
            - White
    dresser_ambilight:
        name: Dresser Ambilight
        options:
            - Fire
            - Lamp
            - Ambilight
            - Rainbow Cycle
            - Colorcycle Fast
            - Colorcycle
            - Colorcycle Slow
            - Sirene
            - Red Cycle
            - Green Cycle
            - Blue Cycle
            - Red
            - Green
            - Blue
            - Yellow
            - Purple
            - Cyan
            - White

input_number:
    fireplace_brightness:
        name: Fireplace brightness
        min: 0
        max: 255
        step: 1
        initial: 255
    dresser_ambilight_brightness:
        name: Dresser Ambilight brightness
        min: 0
        max: 255
        step: 1
        initial: 255
    wake_up_hour:
        name: Wake up Hour
        icon: mdi:timer
        initial: 9
        min: 0
        max: 23
        step: 1
    wake_up_minutes:
        name: Wake up Minutes
        icon: mdi:timer
        initial: 0
        min: 0
        max: 59
        step: 5
    ceiling_fan:
        name: Ceiling Fan
        icon: mdi:fan
        initial: 0
        min: 0
        max: 6
        step: 1
    timer:
        name: Timer
        icon: mdi:timer
        initial: 15
        min: 5
        max: 60
        step: 1

input_boolean:
    inside_house:
        name: inside house? #anybody
        initial: on
    proycon_inside_house:
        name: Proycon inside house?
        initial: on
    hans_inside_house:
        name: Hans inside house?
        initial: on
    guest_inside_house:
        name: Guest inside house?
        initial: off
    flip_main_camera:
        name: Flip main camera
        initial: off

input_text:
    say:
        name: say
        initial: hello
    youtube_link:
        name: Youtube Link
    youtube_link_bedroom:
        name: Youtube Link Bedroom
    tiles_media_volume: #dummy elements to group tiles
        name: tiles_media_volume
    tiles_media_activities:
        name: tiles_media_activities
    tiles_tv_channels:
        name: tiles_tv_channels
    tiles_media_tv_navigation:
        name: tiles_media_tv_navigation
    tiles_all_lights:
        name: tiles_all_lights
    tiles_media_volume_bedroom:
        name: tiles_media_volume_bedroom
    tiles_media_activities_bedroom:
        name: tiles_media_activities_bedroom
    tiles_tv_channels_bedroom:
        name: tiles_tv_channels_bedroom
    tiles_media_tv_navigation_bedroom:
        name: tiles_media_tv_navigation_bedroom
    tiles_robot:
        name: tiles_robot


timer:
    home_notification_lights:
        duration: '00:02:00'
    reset_ipcam:
        duration: '00:05:00'

sensor:
    - platform: buienradar #weather prediction
      name: Weather
      monitored_conditions:
          - symbol
          - temperature
    - platform: time_date
      display_options:
          - 'time'
          - 'date'
    - platform: template
      sensors:
          wake_up_time:
            friendly_name: 'Wake up Time'
            value_template: '{{ "%0.02d:%0.02d" | format(states("input_number.wake_up_hour") | int, states("input_number.wake_up_minutes") | int) }}'
          wake_up_relative_time:
            friendly_name: Wake up relative time #seconds after wake up time
            value_template: "{{ states.sensor.time.state[:2]|int * 60  + states.sensor.time.state[2:4]|int  - states.sensor.wake_up_time.state[:2]|int * 60  + states.sensor.wake_up_time.state[2:4]|int }}"
          robot_battery:
            friendly_name: Robot Battery
            value_template: "{{ states.vacuum.robot.attributes.battery_level }}"
          robot_cleaning_count:
            friendly_name: Robot Cleaning Count
            value_template: "{{ states.vacuum.robot.attributes.cleaning_count }}"
          robot_fan_speed:
            friendly_name: Robot Fan Speed
            value_template: "{{ states.vacuum.robot.attributes.fan_speed }}"
          last_cleaning_duration:
            friendly_name: Last Cleaning Duration
            value_template: "{{ states.vacuum.robot.attributes.cleaning_time }}"
          last_cleaning_time:
            friendly_name: Last Cleaning Time
            value_template: "{{ states.script.vacuum_turn_on.attributes.last_triggered }}"
          office_fibaro_battery:
            friendly_name: Office Fibaro Battery
            value_template: "{{ states.zwave.fibaro_office.attributes.battery_level }}"
          kitchen_fibaro_battery:
            friendly_name: Kitchen Fibaro Battery
            value_template: "{{ states.zwave.fibaro_multisensor.attributes.battery_level }}"
          hall_fibaro_battery:
            friendly_name: Hall Fibaro Battery
            value_template: "{{ states.zwave.fibaro_hall.attributes.battery_level }}"
          bathroom_humidity_battery:
            friendly_name: Bathroom Humidity Battery
            value_template: "{{ states.zwave.bathroom_sensor.attributes.battery_level }}"
          bathroom_window_battery:
            friendly_name: Bathroom Window Battery
            value_template: "{{ states.zwave.bathroom_window.attributes.battery_level }}"
          downstairs_remote_battery:
            friendly_name: Downstairs remote battery
            value_template: "{{ states.zwave.downstairs_remote_battery.attributes.battery_level }}"
    - platform: mqtt
      name: Temperature Living Room
      unit_of_measurement: °C
      state_topic: "home/sensor/temperature_living_room"
    - platform: mqtt
      name: Humidity Living Room
      unit_of_measurement: "%"
      state_topic: "home/sensor/humidity_living_room"
    - platform: mqtt
      name: Bedroom Temperature
      unit_of_measurement: °C
      state_topic: "home/sensor/bedroom_temperature"
    - platform: mqtt
      name: IR Send Activity
      state_topic: "home/ir_send/pi1"
      expire_after: 3
      value_template: 1
    - platform: mqtt
      name: Outside Temperature 1
      unit_of_measurement: °C
      state_topic: "home/weatherstation/temp"
      expire_after: 3600
    - platform: mqtt
      name: Outside Humidity
      unit_of_measurement: "%"
      state_topic: "home/weatherstation/hum"
      expire_after: 3600
    - platform: mqtt
      name: Wind Direction
      unit_of_measurement: °
      state_topic: "home/weatherstation/winddir"
      expire_after: 3600
    - platform: mqtt
      name: Wind Speed
      unit_of_measurement: km/h
      state_topic: "home/weatherstation/windspeed"
      expire_after: 3600
    - platform: mqtt
      name: Wind Gusts
      unit_of_measurement: km/h
      state_topic: "home/weatherstation/windgustspeed"
      expire_after: 3600
    - platform: mqtt
      name: Outside Temperature 2
      unit_of_measurement: °C
      state_topic: "home/weatherstation2/temp"
      expire_after: 3600
    - platform: mqtt
      name: Total Rain
      unit_of_measurement: mm
      state_topic: "home/weatherstation/rain"
      expire_after: 3600
    - platform: dsmr
      port: /dev/ttyUSB0
      dsmr_version: 4




binary_sensor doorbell:
    platform: mqtt
    name: Doorbell
    state_topic: "home/binary_sensor/doorbell"

binary_sensor frontdoor:
    platform: mqtt
    name: Front Door
    state_topic: "home/binary_sensor/frontdoor"
    device_class: opening

binary_sensor backdoor:
    platform: mqtt
    name: Back Door
    state_topic: "home/binary_sensor/backdoor"
    device_class: opening

binary_sensor bedroomwindow_right:
    platform: mqtt
    name: Bedroom window Right
    state_topic: "home/binary_sensor/bedroomwindow_right"
    device_class: opening

binary_sensor bedroomwindow_left:
    platform: mqtt
    name: Bedroom window Left
    state_topic: "home/binary_sensor/bedroomwindow_left"
    device_class: opening


binary_sensor noise:
    platform: mqtt
    name: Noise
    state_topic: "home/binary_sensor/noise"
    device_class: sound

binary_sensor pir_living_room:
    platform: mqtt
    name: PIR Living Room
    state_topic: "home/binary_sensor/pir_living_room"
    payload_on: "ON"
    payload_off: "OFF"
    device_class: motion


binary_sensor:
    platform: template
    sensors:
      anybodyhome:
        friendly_name: "Anybody home?"
        value_template: '{% if is_state("device_tracker.proyphone","home") or is_state("device_tracker.hansphone","home") or is_state("device_tracker.chris","home") or is_state("device_tracker.erik","home") or is_state("device_tracker.patrick","home") %}True{% else %}False{% endif %}'
        entity_id:
            - device_tracker.proyphone
            - device_tracker.hansphone
            - device_tracker.chris
            - device_tracker.erik
            - device_tracker.patrick
        device_class: occupancy
      guest_inside:
        friendly_name: "Guest inside?"
        value_template: '{% if is_state("input_boolean.guest_inside_house","on") %}True{% else %}False{% endif %}'
        entity_id:
            - input_boolean.guest_inside_house
        device_class: occupancy
      pir_kitchen:
        friendly_name: "PIR Kitchen"
        value_template: '{{ is_state("sensor.fibaro_multisensor_burglar", "8") }}'
        entity_id:
            - sensor.fibaro_multisensor_burglar
        device_class: motion
      pir_hall:
        friendly_name: "PIR Hall"
        value_template: '{{ is_state("sensor.fibaro_hall_burglar", "8") }}'
        entity_id:
            - sensor.fibaro_hall_burglar
        device_class: motion
      pir_office:
        friendly_name: "PIR Office"
        value_template: '{{ is_state("sensor.fibaro_office_burglar", "8") }}'
        entity_id:
            - sensor.fibaro_office_burglar
        device_class: motion
      pir_jaiko:
        friendly_name: "PIR Jaiko"
        value_template: '{{ is_state("sensor.dogsensor_burglar", "8") }}'
        entity_id:
            - sensor.dogsensor_burglar
        device_class: motion
      bathroom_too_humid:
        friendly_name: "Bathroom too humid"
        value_template: '{{ states("sensor.bathroom_sensor_relative_humidity") | float > 75.0 }}'
        entity_id:
            - sensor.bathroom_sensor_relative_humidity


switch tv_spots:
    platform: mqtt
    name: TV Spots
    state_topic: "home/433send/get/elro/31/E"
    command_topic: "home/433send/set/pi1/elro/31/E"
switch office:
    platform: mqtt
    name: Office
    state_topic: "home/433send/get/elro/15/A"
    command_topic: "home/433send/set/pi2/elro/15/A"
switch front_room:
    platform: mqtt
    name: Front Room
    state_topic: "home/433send/get/oldkaku/M/10"
    command_topic: "home/433send/set/pi1/oldkaku/M/10"
switch midspots:
    platform: mqtt
    name: Midspots
    state_topic: "home/433send/get/elro/31/B"
    command_topic: "home/433send/set/pi2/elro/31/B"
switch back_room:
    platform: mqtt
    name: Back room
    state_topic: "home/433send/get/elro/31/A"
    command_topic: "home/433send/set/pi2/elro/31/A"
switch back_corner:
    platform: mqtt
    name: Back Corner
    state_topic: "home/433send/get/elro/31/C"
    command_topic: "home/433send/set/pi2/elro/31/C"
switch kitchen:
    platform: mqtt
    name: Kitchen
    state_topic: "home/433send/get/newkaku/120/7"
    command_topic: "home/433send/set/pi1/newkaku/120/7"
switch bedroom:
    platform: mqtt
    name: Bedroom
    state_topic: "home/433send/get/elro/15/C"
    command_topic: "home/433send/set/pi2/elro/15/C"
switch garden:
    platform: mqtt
    name: Garden
    state_topic: "home/433send/get/elro/23/A"
    command_topic: "home/433send/set/pi2/elro/23/A"
switch balcony:
    platform: mqtt
    name: Balcony
    state_topic: "home/433send/get/newkaku/121/9"
    command_topic: "home/433send/set/pi2/newkaku/121/9"
    #state_topic: "home/elro/get/23/2"
    #command_topic: "home/elro/set/pi2/23/2"
switch hall:
    platform: mqtt
    name: Hall
    state_topic: "home/433send/get/elro/15/B"
    command_topic: "home/433send/set/pi1/elro/15/B"
switch roof:
    platform: mqtt
    name: Roof
    state_topic: "home/433send/get/newkaku/121/8"
    command_topic: "home/433send/set/pi2/newkaku/121/8"
    #state_topic: "home/elro/get/23/4"
    #command_topic: "home/elro/set/pi2/23/4"
switch porch:
    platform: mqtt
    name: Porch
    state_topic: "home/433send/get/oldkaku/M/11"
    command_topic: "home/433send/set/pi1/oldkaku/M/11"
switch bathroom_vent:
    platform: mqtt
    name: Bathroom Vent
    state_topic: "home/433send/get/newkaku/121/7"
    command_topic: "home/433send/set/pi2/newkaku/121/7"
    #state_topic: "home/elro/get/23/4"
    #command_topic: "home/elro/set/pi2/23/4"
switch tv_decoder:
    platform: mqtt
    name: TV Decoder
    command_topic: "home/ir_send/pi1"
    payload_on: '{"device":"VIP1853","key":"POWER"}'
    payload_off: '{"device":"VIP1853","key":"POWER"}'
switch tv_decoder_bedroom:
    platform: mqtt
    name: TV Decoder Bedroom
    command_topic: "home/ir_send/pi2"
    payload_on: '{"device":"VIP1853","key":"POWER"}'
    payload_off: '{"device":"VIP1853","key":"POWER"}'
switch pi1_kodi:
    platform: mqtt
    name: Pi1 Kodi
    command_topic: "home/kodi/set/pi1"
    state_topic: "home/kodi/get/pi1"
switch pi1_music_player:
    platform: mqtt
    name: Pi1 Music Player
    command_topic: "home/musicplayer/set/pi1"
    state_topic: "home/musicplayer/get/pi1"
switch pi1_xorg:
    platform: mqtt
    name: Pi1 Xorg
    command_topic: "home/xorg/set/pi1"
    state_topic: "home/xorg/get/pi1"
switch pi2_kodi:
    platform: mqtt
    name: Pi2 Kodi
    command_topic: "home/kodi/set/pi2"
    state_topic: "home/kodi/get/pi2"
switch pi2_music_player:
    platform: mqtt
    name: Pi2 Music Player
    command_topic: "home/musicplayer/set/pi2"
    state_topic: "home/musicplayer/get/pi2"
switch pi2_xorg:
    platform: mqtt
    name: Pi2 Xorg
    command_topic: "home/xorg/set/pi2"
    state_topic: "home/xorg/get/pi2"
switch tv:
    platform: mqtt
    name: TV
    command_topic: "home/hdmi_cec_send/pi1"
    state_topic: "home/hdmi_cec_send/pi1"
    payload_on: "on 0"
    payload_off: "standby 0"
switch tv_bedroom:
    platform: mqtt
    name: TV Bedroom
    command_topic: "home/ir_send/pi2"
    state_topic: "home/ir_send/pi2"
    payload_on: '{"device":"tvboven","key":"KEY_POWER","state":"on"}'
    payload_off: '{"device":"tvboven","key":"KEY_POWER","state":"off"}'
switch technofire:
    platform: mqtt
    name: Technofire
    command_topic: "home/technofire/pi3/set/fire/255"
    state_topic: "home/technofire/pi3/state"
switch ambilight:
    platform: mqtt
    name: Ambilight
    command_topic: "home/technofire/pi2/set/lamp/40"
    state_topic: "home/technofire/pi2/state"
switch noise_detector:
    platform: mqtt
    name: Noise detector
    command_topic: "home/noisedetector/set/pi1"
    state_topic: "home/noisedetector/get/pi1"

fan:
  - platform: mqtt
    name: "Ceiling fan"
    command_topic: "home/fan"
    speed_command_topic: "home/fan"
    payload_on: "true"
    payload_off: "off"
    payload_low_speed: "2"
    payload_medium_speed: "4"
    payload_high_speed: "6"
    speeds:
      - low
      - medium
      - high


vacuum:
  - name: robot
    platform: xiaomi_miio
    host: !secret roboip
    token: !secret robotoken

#hdmi_cec:
#    host: !secret pi1_ip
#    types:
#       hdmi_cec.hdmi_0: switch #will expose a switch.hdmi_0 entity

media_player hall_speaker:
    - platform: vlc
      name: Hall speaker
      arguments: '--alsa-audio-device=hw:0,0'

media_player yamaha_receiver:
  - platform: yamaha
    host: !secret avr_ip
    source_names:
        HDMI1: "TV Decoder"
        HDMI2: "Pi1"

media_player mpd:
  - platform: mpd
    host: 127.0.0.1
    password: !secret mpd_password

media_player kodi:
    - platform: kodi
      name: Kodi
      host: !secret pi1_ip
      username: !secret kodi_username
      password: !secret kodi_password
      #turn_on_action:
      #    - service: script.turn_on
      #      data:
      #          entity_id: script.media_centre
      #turn_off_action:
      #    - service: script.turn_off
      #      data:
      #          entity_id: script.turn_media_off

media_player kodi_bedroom:
    - platform: kodi
      name: Kodi Bedroom
      host: !secret pi2_ip
      username: !secret kodi_username
      password: !secret kodi_password

matrix:
  homeserver: https://matrix.org
  username: !secret matrix_id
  password: !secret matrix_password
  rooms:
    - !secret matrix_room
  commands:
    - word: "lights_on"
      name: lights_on #hook not implemented yet

notify:
  - name: xmpp_proycon
    platform: xmpp
    sender: !secret xmpp_sender
    password: !secret xmpp_password
    recipient: !secret xmpp_proycon
    verify: false
  - name: xmpp_hans
    platform: xmpp
    sender: !secret xmpp_sender
    password: !secret xmpp_password
    recipient: !secret xmpp_hans
    verify: false
  - name: mail_both
    platform: smtp
    sender: !secret mail_sender
    server: localhost
    port: 25
    encryption: starttls
    debug: true
    username: !secret mail_user
    password: !secret mail_password
    recipient:
        - !secret xmpp_proycon
        - !secret xmpp_hans
  - name: sms
    platform: message_bird
    api_key: !secret messagebird_apikey
  - name: matrix
    platform: matrix
    default_room: !secret matrix_room

#MQTT
mqtt:
    broker: 127.0.0.1
    port: 8883
    client_id: master
    certificate: /etc/ssl/certs/ca-certificates.crt
    tls_insecure: true #allow non-matching hostnames
    keepalive: 60
    username: homeassistant
    password: !secret api_password


#mqtt_eventstream:
#  publish_topic: master
#  subscribe_topic: slaves/#
