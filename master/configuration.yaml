homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 161
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Amsterdam

  customize:
    switch.tv_spots:
        icon: mdi:lightbulb
    switch.office:
        icon: mdi:lightbulb
    switch.front_room:
        icon: mdi:lightbulb
    switch.midspots:
        icon: mdi:lightbulb
    switch.back_room:
        icon: mdi:lightbulb
    switch.back_corner:
        icon: mdi:lightbulb
    switch.bedroom:
        icon: mdi:lightbulb
    switch.garden:
        icon: mdi:lightbulb
    switch.balcony:
        icon: mdi:lightbulb
    switch.hall:
        icon: mdi:lightbulb
    switch.roof:
        icon: mdi:lightbulb
    switch.tvdecoder:
        icon: mdi:airplay
    switch.tv:
        icon: mdi:television
    switch.avr:
        icon: mdi:music_box_outline
    switch.tvdecoder_1:
        icon: mdi:numeric_one_box

# Enables the frontend
frontend:

# Enables configuration UI
config:

http:
  api_password: !secret api_password
  use_x_forwarded_for: True
  # Uncomment this if you are using SSL or running in Docker etc
  # base_url: example.duckdns.org:8123

# Checks for available updates
# Note: This component will send some information about your system to
# the developers to assist with development of Home Assistant.
# For more information, please see:
# https://home-assistant.io/blog/2016/10/25/explaining-the-updater/
updater:
  # Optional, allows Home Assistant developers to focus on popular components.
  # include_used_components: true

# Discover some devices automatically
discovery:

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

# Enables support for tracking state changes over time.
history:
    exclude:
      entities:
        - automation.snapshots_frontdoor
        - automation.snapshots_garden
        - automation.snapshots_street
        - automation.snapshots_livingroom
        - automation.snapshots_hallupstairs

# View all events in a logbook
logbook:
    exclude:
      entities:
        - automation.snapshots_frontdoor
        - automation.snapshots_garden
        - automation.snapshots_street
        - automation.snapshots_livingroom
        - automation.snapshots_hallupstairs

# Track the sun
sun:

sensor:
    - platform: buienradar #weather prediction
      name: Weather
      monitored_conditions:
          - symbol
          - temperature

binary_sensor doorbell:
    platform: mqtt
    name: Doorbell
    state_topic: "home/binary_sensor/doorbell"

binary_sensor frontdoor:
    platform: mqtt
    name: Front Door
    state_topic: "home/binary_sensor/frontdoor"
    device_class: opening

binary_sensor backdoor:
    platform: mqtt
    name: Back Door
    state_topic: "home/binary_sensor/backdoor"
    device_class: opening

binary_sensor bedroomwindow_right:
    platform: mqtt
    name: Bedroom window Right
    state_topic: "home/binary_sensor/bedroomwindow_right"
    device_class: opening

binary_sensor bedroomwindow_left:
    platform: mqtt
    name: Bedroom window Left
    state_topic: "home/binary_sensor/bedroomwindow_left"
    device_class: opening

binary_sensor:
    platform: template
    sensors:
      anybodyhome:
        friendly_name: "Anybody home?"
        value_template: '{% if is_state("device_tracker.proyphone","home") or is_state("device_tracker.hansphone","on") %}on{% else %}off{% endif %}'
        entity_id:
            - device_tracker.proyphone
            - device_tracker.hansphone
        device_class: occupancy


switch tv_spots:
    platform: mqtt
    name: TV Spots
    state_topic: "home/elro/get/beneden/16"
    command_topic: "home/elro/set/pi1/beneden/16"
switch office:
    platform: mqtt
    name: Office
    state_topic: "home/elro/get/boven/1"
    command_topic: "home/elro/set/pi2/boven/1"
switch front_room:
    platform: mqtt
    name: Front Room
    state_topic: "home/kaku/get/M/10"
    command_topic: "home/kaku/set/pi1/M/10"
switch midspots:
    platform: mqtt
    name: Midspots
    state_topic: "home/elro/get/beneden/2"
    command_topic: "home/elro/set/pi2/beneden/2"
switch back_room:
    platform: mqtt
    name: Back room
    state_topic: "home/elro/get/beneden/1"
    command_topic: "home/elro/set/pi2/beneden/1"
switch back_corner:
    platform: mqtt
    name: Back Corner
    state_topic: "home/elro/get/beneden/4"
    command_topic: "home/elro/set/pi2/beneden/4"
switch bedroom:
    platform: mqtt
    name: Bedroom
    state_topic: "home/elro/get/boven/4"
    command_topic: "home/elro/set/pi2/boven/4"
switch garden:
    platform: mqtt
    name: Garden
    state_topic: "home/elro/get/buiten/1"
    command_topic: "home/elro/set/pi2/buiten/1"
switch balcony:
    platform: mqtt
    name: Balcony
    state_topic: "home/elro/get/buiten/2"
    command_topic: "home/elro/set/pi2/buiten/2"
switch hall:
    platform: mqtt
    name: Hall
    state_topic: "home/elro/get/boven/2"
    command_topic: "home/elro/set/pi1/boven/2"
switch roof:
    platform: mqtt
    name: Roof
    state_topic: "home/elro/get/buiten/4"
    command_topic: "home/elro/set/pi2/buiten/4"
switch avr:
    platform: mqtt
    name: AVR
    state_topic: "home/switch/avr"
    command_topic: "home/switch/avr/set"
switch tvdecoder:
    platform: mqtt
    name: TV Decoder
    state_topic: "home/switch/tvdecoder"
    command_topic: "home/switch/tvdecoder/set"
switch tv:
    platform: mqtt
    name: TV
    state_topic: "home/switch/tv"
    command_topic: "home/switch/tv/set"

media_player hall_speaker:
    - platform: vlc
      name: hall_speaker
      arguments: '--alsa-audio-device=hw:0,0'

camera:
    - id: livingroom
      platform: local_file
      name: Living Room
      file_path: /home/homeautomation/homeassistant/snapshots/_livingroom.jpg
    - id: street
      platform: local_file
      name: Street
      file_path: /home/homeautomation/homeassistant/snapshots/_street.jpg
    - id: frontdoor
      platform: local_file
      name: Front door
      file_path: /home/homeautomation/homeassistant/snapshots/_frontdoor.jpg
    - id: hallupstairs
      platform: local_file
      name: Hall upstairs
      file_path: /home/homeautomation/homeassistant/snapshots/_hallupstairs.jpg
    - id: garden
      platform: local_file
      name: Garden
      file_path: /home/homeautomation/homeassistant/snapshots/_garden.jpg
    #- platform: generic
    #  name: Streetcam
    #  still_image_url: !secret streetcam_url
    #- platform: generic
    #  name: Gardencam
    #  still_image_url: !secret gardencam_url

shell_command:
    snapshot_livingroom: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh livingroom
    snapshot_street: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh street
    snapshot_garden: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh garden
    snapshot_frontdoor: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh frontdoor
    snapshot_hallupstairs: /home/homeautomation/homeassistant/scripts/camera/takesnapshot.sh hallupstairs
    archive_snapshots: /home/homeautomation/homeassistant/scripts/camera/archive.sh
    snapshot_clear_locks: find . -type f -name "*.lock" | xargs rm

hdmi_cec:
    host: !secret pi1_ip


device_tracker:
    - platform: tplink
      host: !secret wifirouter_host
      username: !secret wifirouter_user
      password: !secret wifirouter_pass
    - platform: ping
      hosts:
          pi1: !secret pi1_ip
          pi2: !secret pi2_ip
          pi3: !secret pi3_ip

# Text to speech
tts:
  platform: picotts
  language: 'en-GB'

group: !include groups.yaml
automation: !include automations.yaml
script:
    trigger_slave_poll:
        alias: Repoll slaves
        sequence:
          - service: mqtt.publish #trigger RPi slaves to send their known statussen again
            data:
                topic: "home/poll"
                payload: "ON"
    avr_volup:
        alias: Volume up (AVR)
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"avr","key":"KEY_VOLUMEUP"}'
    avr_voldown:
        alias: Volume down (AVR)
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"avr","key":"KEY_VOLUMEDOWN"}'
    avr_mute:
        alias: Mute (AVR)
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"avr","key":"KEY_MUTE"}'
    avr_power:
        alias: Power (AVR) #replace with switch?
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"avr","key":"KEY_POWER"}'
    tvdecoder_channelup:
        alias: Channel up
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"CHANNEL_UP"}'
    tvdecoder_channeldown:
        alias: Channel down
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"CHANNEL_DOWN"}'
    tvdecoder_playpause:
        alias: Play/pause Toggle
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"PLAY_PAUSE"}'
    tvdecoder_ok:
        alias: OK
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"OK"}'
    tvdecoder_back:
        alias: Back
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"BACK"}'
    tvdecoder_down:
        alias: Down
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"down"}'
    tvdecoder_up:
        alias: Up
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"UP"}'
    tvdecoder_left:
        alias: left
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"LEFT"}'
    tvdecoder_right:
        alias: right
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"RIGHT"}'
    tvdecoder_1:
        alias: 1
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_1"}'
    tvdecoder_2:
        alias: 2
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_2"}'
    tvdecoder_3:
        alias: 3
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_3"}'
    tvdecoder_4:
        alias: 4
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_1"}'
    tvdecoder_5:
        alias: 5
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_5"}'
    tvdecoder_6:
        alias: 6
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
    tvdecoder_7:
        alias: 7
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_7"}'
    tvdecoder_8:
        alias: 8
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_8"}'
    tvdecoder_9:
        alias: 9
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_9"}'
    tvdecoder_0:
        alias: 0
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_0"}'
    tvdecoder_npo1:
        alias: TV Channel - NPO1
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
              milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
              milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_1"}'
    tvdecoder_npo2:
        alias: TV Channel - NPO2
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
              milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
              milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_2"}'
    tvdecoder_npo3:
        alias: TV Channel - NPO3
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
              milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
              milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_3"}'
    tvdecoder_rtl4:
        alias: TV Channel - RTL4
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_4"}'
    tvdecoder_veronica:
        alias: TV Channel - Veronica
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_9"}'
    tvdecoder_een:
        alias: TV Channel - Één
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_7"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_2"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_1"}'
    tvdecoder_canvas:
        alias: TV Channel - Canvas
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_7"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_2"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_2"}'
    tvdecoder_bbc1st:
        alias: TV Channel - BBC First
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_7"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_2"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_9"}'
    tvdecoder_bbc1:
        alias: TV Channel - BBC One
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_7"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_3"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_0"}'
    tvdecoder_bbc2:
        alias: TV Channel - BBC Two
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_7"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_3"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_1"}'
    tvdecoder_ard:
        alias: TV Channel - ARD
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_4"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_4"}'
    tvdecoder_zdf:
        alias: TV Channel - ZDF
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_4"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_5"}'
    tvdecoder_wdr:
        alias: TV Channel - WDR
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_4"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_8"}'
    tvdecoder_arte:
        alias: TV Channel - Arte
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_4"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_9"}'
    tvdecoder_tv5monde:
        alias: TV Channel - TV 5 Monde
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_9"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_2"}'
    tvdecoder_rai1:
        alias: TV Channel - Rai 1
        sequence:
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_9"}'
          - delay:
                milliseconds: 400
          - service: mqtt.publish
            data:
                topic: "home/ir_send/pi1"
                payload: '{"device":"VIP1853","key":"KEY_6"}'
          - delay:
                milliseconds: 400
    doorbell_sound:
        alias: Doorbell sound
        sequence:
            - service: media_player.play_media
              data:
                  entity_id: media_player.hall_speaker
                  media_content_id: /home/homeautomation/homeassistant/media/doorbell.ogg
                  media_content_type: 'music'
    dog_sound:
        alias: Dog barking sound
        sequence:
            - service: media_player.play_media
              data:
                  entity_id: media_player.hall_speaker
                  media_content_id: /home/homeautomation/homeassistant/media/dog.wav
                  media_content_type: 'music'
    chime_sound:
        alias: Chime sound
        sequence:
            - service: media_player.play_media
              data:
                  entity_id: media_player.hall_speaker
                  media_content_id: /home/homeautomation/homeassistant/media/chime.wav
                  media_content_type: 'music'



#MQTT
mqtt:
    broker: 127.0.0.1
    port: 1883
    client_id: master
    keepalive: 60
    username: homeassistant
    password: !secret api_password


#mqtt_eventstream:
#  publish_topic: master
#  subscribe_topic: slaves/#
